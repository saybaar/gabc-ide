<!DOCTYPE html>
<html>
<header>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.js"></script>
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.0/css/bootstrap.min.css" />
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.0/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="/socket.io/socket.io.js"></script>
</header>
<style>
  .pdfobject-container { height: 4in; width:6in; border: 1rem solid rgba(0,0,0,.1); }
  a { cursor: pointer; }
</style>

<body>
  <div class="container-fluid">
    <div class="row my-1">
      <div id="hello" class="col" data-toggle="collapse" data-target="#about">Hello!</div>
    </div>
    <div class="row my-1">
      <div id="about" class="col collapse">
        Here is some text about this app!
      </div>
    </div>
    <div class="row">
      <div class="col-md">
        <div class="row my-1" id="controls">
          <div class="col">
            <a id="load-simple" class="text-primary">Load simple example</a> â€¢
            <a id="load-full" class="text-primary">Load full example</a>
            (<a href="http://gregorio-project.github.io/gabc/details.html">source</a>)
            <button id="submit" type="button" class="btn btn-primary float-right">submit</button>
          </div>
        </div>
        <textarea id="input" class="form-control" spellcheck="false" rows="20"
                  style="min-width: 100%; font-family:monospace;"></textarea>
        <div id="output"></div>
      </div>
      <div class="col-md">
        <div id="audio"></div>
        <div id="image"></div>
      </div>
    </div>
  </div>
</body>
<script type="text/javascript">
  console.log('hello');

  var objectSocket = io.connect('http://localhost:8080/');
  var strIdent = '';
  objectSocket.on('hello', function(objectData) {
    strIdent = objectData.strIdent;
  });

  console.log('connected with id ' + strIdent);

  $('#submit').on('click', function() {
    objectSocket.emit('gen', {
      'gabc': $('#input').val()
    })
  });

  $("#load-simple").on("click", function() {
    $.get('short_example.gabc', function(data) {
      $('#input').val(data);
    });
  });

  $("#load-full").on("click", function() {
    $.get('example.gabc', function(data) {
      $('#input').val(data);
    });
  });

  objectSocket.on('audio', function(data) {
    $("#audio").html("<audio controls src=" + objectSocket.io.engine.id + "/test.wav?timestamp=" + new Date().getTime() + "></audio");
  });
  objectSocket.on('image', function(data) {
    $("#image").html("<img class='img-fluid' src=" + objectSocket.io.engine.id + "/test.png?timestamp=" + new Date().getTime() + "></img>");
    // PDFObject.embed(objectSocket.io.engine.id + '/test.pdf', "#output", );
  });
  objectSocket.on('foobar', function(data) {
    $('#output').text('Error from ' + data.source + ':\n' + data.log);
  });

  //$(document).ready(function() {});
</script>

</html>
