<!DOCTYPE html>
<html>
<header>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.js"></script>
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.0/css/bootstrap.min.css" />
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.0/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="/socket.io/socket.io.js"></script>
</header>
<style>
  .pdfobject-container { height: 4in; width:6in; border: 1rem solid rgba(0,0,0,.1); }
</style>

<body>
  <div class="container-fluid">
    <div class="row my-1">
      <div id="hello" class="col" data-toggle="collapse" data-target="#about">Hello!</div>
    </div>
    <div class="row my-1">
      <div id="about" class="col collapse">
        Here is some text about this app!
      </div>
    </div>
    <div class="row">
      <div class="col-md">
        <div class="row my-1" id="controls">
          <div class="col">
            <a id="load-simple">Load simple example</a> â€¢
            <a id="load-full">Load full example</a>
            (<a href="http://gregorio-project.github.io/gabc/details.html">source</a>)
            <button id="submit" type="button" class="btn btn-primary float-right">submit</button>
          </div>
        </div>
        <textarea id="input" class="form-control" style="min-width: 100%; font-family:monospace;" spellcheck="false" rows="20"></textarea>
        <div id="output"></div>
      </div>
      <div class="col-md">
        <audio controls id="audio"></audio>
        <img class="img-fluid" id="image"></img>
      </div>
    </div>
  </div>
</body>
<script type="text/javascript">
  console.log('hello');

  var objectSocket = io.connect('http://localhost:8080/');
  var strIdent = '';
  objectSocket.on('hello', function(objectData) {
    strIdent = objectData.strIdent;
  });

  console.log('connected with id ' + strIdent);

  $('#submit').on('click', function() {
    objectSocket.emit('gen', {
      'gabc': $('#input').val()
    })
  });

  $("#load-simple").on("click", function() {
    $('#input').load('short_example.gabc');
  });

  $("#load-full").on("click", function() {
    $('#input').load('example.gabc');
  });

  objectSocket.on('audio', function(data) {
    $("#audio").attr("src", objectSocket.io.engine.id + "/test.wav?timestamp=" + new Date().getTime());
  });
  objectSocket.on('image', function(data) {
    console.log('success! embedding image...');
    $("#image").attr("src", objectSocket.io.engine.id + "/test.png");
    // PDFObject.embed(objectSocket.io.engine.id + '/test.pdf', "#output", );
  });
  objectSocket.on('foobar', function(data) {
    $('#output').text('Error from ' + data.source + ':\n' + data.log);
  });

  //$(document).ready(function() {});
</script>

</html>
